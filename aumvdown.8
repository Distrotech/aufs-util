.\".so aufs.tmac
.
.eo
.de TQ
.br
.ns
.TP \$1
..
.de Bu
.IP \(bu 4
..
.ec
.\" end of macro definitions
.
.\" ----------------------------------------------------------------------
.TH AUMVDOWN 8 aufs3.9 Linux "Linux Aufs User's Manual"
.SH NAME
aumvdown \- moves-down a file between aufs branches

.\" ----------------------------------------------------------------------
.SH SYNOPSIS
.SY aumvdown
.OP options
.RI file_in_aufs
.IR .\|.\|.
.YS

.\" ----------------------------------------------------------------------
.SH DESCRIPTION
"aumvdown" command finds the first branch where the given file exists,
copies it to the next lower writable branch, and then removes the file
on the first branch.

There are several conditions to achieve the operation.
.RS
.Bu
It is obvious that when the file exists between the first and the next
lower writable branches, or hidden by the whiteout or directory's
opaque-ness, then the operation will fail. Because it breaks
the consistency in aufs world.

In this case, EINVAL will be returned.
.Bu
If a "opaque"-ed directory exists in the ancestors of the file and it
would hide the moved-down file, then the operation will fail.

Similary if a whiteout (in effect) exists on any branch betwee source
and destination branch and it would hide  the moved-down file,
then the operation will fail too.
Note that the whiteout on "=ro" branch is not in effect, but "=ro+wh"
branch.

In these cases, EINVAL will be returned.
.Bu
Files in use (both in aufs world and in branch filesystem) are not be
handled.

In this case, EBUSY will be returned.
.Bu
Hard-linked files are not be handled.

In this case, EBUSY will be returned.
For such file, remount aufs or use \fBauplink\fP(8) or\fBaubrsync\fP(8).
.Bu
Removed files are not be handled since it has no name.

In this case, ENOENT will be returned.
.Bu
Directories are not be handled since the action doesn't behave
recursively and the moving-down an empty dir has less meaning.

In this case, EDIR will be returned.
.RE

.\" ----------------------------------------------------------------------
.SH OPTIONS
.
.TP
.B \-i | \-\-interactive
Prompt to the user for every given file.
.
.TP
.B \-v | \-\-verbose
Make it verbose particularly for the error cases.
Note that some of the messages are printed by kernel and left in your
syslog file.
.
.TP
.B \-h | \-\-help
Shows the command syntax.
.\" .
.\" .TP
.\" .B \-V | \-\-version

.\" ----------------------------------------------------------------------
.SH SEE ALSO
.\" \fBaubrsync\fP(8)
\fBaufs\fP(5)

.SH COPYRIGHT
Copyright \(co 2011\-2013 Junjiro R. Okajima

.SH AUTHOR
Junjiro R. Okajima
